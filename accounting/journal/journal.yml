# Charges et produits constatés d'avance (CCA et PCA)
Deferral:
  id: serial32
  type: enum(CHARGE, PRODUCT)
  operation: journal\Operation
  startDate: date # Début conso
  endDate: date # Fin conso
  amount: decimal(8, 2, 0.01, null)
  financialYear: account\FinancialYear
  status: enum(PLANNED, RECORDED, DEFERRED, CANCELLED)
  createdAt: datetime = SPECIAL(now)
  updatedAt: datetime = SPECIAL(now)
  createdBy: ?user\User = SPECIAL(user)
  INDEX: [
    ["financialYear"],
    ["status"]
  ]

JournalCode:
  id: serial32
  name: text8(1, null) @collate(general)
  code: text8(2,4)
  isCustom: bool = TRUE
  color: ?color
  isReversable: bool = FALSE # est extournable
  isDisplayed: bool = TRUE # est affiché dans les onglets
  UNIQUE: [
    ["code"]
  ]

Operation:
  id: serial32
  # Identifiant pour regrouper les opérations enregistrées ensemble
  hash: ?textFixed(20, 20) @charset(ascii)
  number: ?int32(0, null)
  financialYear: account\FinancialYear
  journalCode: ?journal\JournalCode
  # Compte concerné par l'opération
  account: account\Account
  accountLabel: text8(1, null) @collate(general)
  thirdParty: ?account\ThirdParty
  date: date(PHP(toDate('NOW - 2 YEARS')), PHP(toDate('NOW + 1 YEARS')))
  # Libellé de l'opération
  description: text8(1, null) @collate(general)
  document: ?text8(1, null) @collate(general)
  documentDate: ?date
  invoice: ?selling\Invoice
  # Une opération est toujours HT
  amount: decimal(8, 2)
  type: enum(DEBIT, CREDIT)
  vatRate: decimal(5, 2) = 0.00
  vatAccount: ?account\Account
  # Opération à laquelle celle-ci est liée (ex: opération de TVA reliée à une autre opération)
  operation: ?journal\Operation
  # Immobilisation à laquelle cette opération est liée
  asset: ?asset\Asset
  paymentDate: ?date
  paymentMethod: ?payment\Method
  vatRule: ?enum(VAT_STD, VAT_0, VAT_HCA, VAT_HC)
  isSelfConsumption: bool = FALSE
  createdAt: datetime = SPECIAL(now)
  updatedAt: datetime = SPECIAL(now)
  validatedAt: ?datetime = SPECIAL(now)
  createdBy: ?user\User = SPECIAL(user)
  INDEX: [
    ["document"],
    ["hash"]
  ]
  SEARCH: [
    ["accountLabel", "description", "document"]
  ]

OperationCashflow:
  operation: journal\Operation
  cashflow: bank\Cashflow
  hash: ?textFixed(20, 20) @charset(ascii)
  UNIQUE: [
    ["operation", "cashflow"]
  ]
